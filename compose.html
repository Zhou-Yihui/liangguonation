<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>SCMS - å†™ä¿¡</title>
  <style>
    body{font-family:"Microsoft YaHei",sans-serif;background:#0b0c2a;color:#fff;margin:0;}
    header{background:rgba(255,255,255,.05);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;}
    header button{padding:6px 14px;border:none;border-radius:5px;background:#f0c000;color:#000;cursor:pointer;margin-left:8px;}
    h1{margin:20px;text-align:center;}
    #compose{width:90%;max-width:600px;margin:auto;display:flex;flex-direction:column;gap:10px;}
    input,textarea{width:100%;padding:8px;border-radius:5px;border:none;background:#111;color:#fff;}
    textarea{height:140px;resize:vertical;}
    #sendBtn{background:#f0c000;color:#000;font-weight:bold;cursor:pointer;padding:10px;}
    #sendBtn:hover{background:#ffd700;}
    #msg{color:#ff9;margin-top:8px;text-align:center;}
  </style>
  <script>(()=>{if(!localStorage.getItem("SCMS-currentUser"))location.replace('email.html');})();</script>
</head>
<body>
<header>
  <span>âœ‰ï¸ å†™ä¿¡ / Compose</span>
  <div>
    <button onclick="loc('inbox.html')">ğŸ“¥ æ”¶ä»¶ç®±</button>
    <button onclick="loc('sent.html')">ğŸ“¤ å‘ä»¶ç®±</button>
    <button onclick="logout()">é€€å‡º</button>
  </div>
</header>

<div id="compose">
  <input id="to" placeholder="æ”¶ä»¶äººé‚®ç®± / To">
  <input id="subject" placeholder="ä¸»é¢˜ / Subject">
  <textarea id="body" placeholder="æ­£æ–‡ / Message"></textarea>
  <button id="sendBtn" onclick="sendMail()">å‘é€é‚®ä»¶</button>
  <div id="msg"></div>
</div>

<script>
const u = localStorage.getItem("SCMS-currentUser");
function loc(p){location.href=p;}
function logout(){
  localStorage.removeItem("SCMS-currentUser");
  location.href='email.html';
}

function sendMail(){
  const to    = document.getElementById('to').value.trim();
  const subj  = document.getElementById('subject').value.trim();
  const body  = document.getElementById('body').value.trim();
  if(!to||!subj||!body) return msg('è¯·å¡«å†™å®Œæ•´ï¼');

  const users = JSON.parse(localStorage.getItem("SCMS-users")||"{}");
  if(!users[to]) return msg('æ”¶ä»¶äººä¸å­˜åœ¨ï¼');

  function sendMail(){
  const to    = document.getElementById('to').value.trim();
  const subj  = document.getElementById('subject').value.trim();
  const body  = document.getElementById('body').value.trim();
  if(!to||!subj||!body) return msg('è¯·å¡«å†™å®Œæ•´ï¼');

  const users = JSON.parse(localStorage.getItem("SCMS-users")||"{}");
  if(!users[to]) return msg('æ”¶ä»¶äººä¸å­˜åœ¨ï¼');

  const mail = {
    from: u + '@lyurchxieria.com', // åœ¨è¿™é‡Œæ‹¼æ¥åŸŸå
    to: to + '@lyurchxieria.com', // å¦‚æœæ”¶ä»¶äººä¹Ÿéœ€è¦å®Œæ•´åŸŸåï¼Œä¹Ÿåœ¨è¿™é‡Œæ‹¼æ¥
    subject: subj,
    content: body,
    date: Date.now()
  };
  users[to].inbox.push(mail);
  users[u].sent.push(mail);
  localStorage.setItem("SCMS-users", JSON.stringify(users));

  msg('å‘é€æˆåŠŸï¼');
  setTimeout(()=>location.href='sent.html', 800);   // è‡ªåŠ¨è·³è½¬å‘ä»¶ç®±
}

  msg('å‘é€æˆåŠŸï¼');
  setTimeout(()=>location.href='sent.html', 800);   // è‡ªåŠ¨è·³è½¬å‘ä»¶ç®±
}
function msg(t){document.getElementById('msg').textContent=t;}
</script>
</body>
</html>