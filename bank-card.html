<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¤§æ¶¼éŠ€è¡Œï½œéŠ€è¡Œå¡</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <link rel="manifest" href="manifest.json">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft JhengHei",serif}
    body{background:#faf6f0;color:#333;height:100vh;display:flex;flex-direction:column}
    /* é ‚æ¬„ */
    .top-bar{height:48px;background:linear-gradient(90deg,#8B0000 70%,#D4AF37);color:#FFD700;display:flex;align-items:center;padding:0 12px;box-shadow:0 2px 4px rgba(0,0,0,.2)}
    .top-bar .back{font-size:22px;margin-right:6px}
    .top-bar .tit{flex:1;font-size:18px;letter-spacing:2px}
    .top-bar .add{font-size:26px}
    /* æ»¾å‹•å€ */
    .scroll{flex:1;overflow-y:auto;padding:12px}
    /* å¡ç‰‡åˆ—è¡¨ */
    .card-item{background:linear-gradient(135deg,#8B0000 0%,#B22222 50%,#D4AF37 100%);margin-bottom:12px;border-radius:16px;padding:20px;color:#fff;position:relative;box-shadow:0 4px 10px rgba(0,0,0,.15)}
    .card-item .type{font-size:12px;letter-spacing:1px}
    .card-item .num{font-size:19px;letter-spacing:2px;margin:8px 0}
    .card-item .balance{font-size:22px;font-weight:bold;text-shadow:0 0 4px rgba(0,0,0,.4)}
    .card-item .btn-row{display:flex;gap:8px;margin-top:14px}
    .card-item .btn-row button{flex:1;padding:8px;background:rgba(255,215,0,.25);border:1px solid #FFD700;border-radius:6px;color:#FFD700;font-size:13px}
    /* ç©ºæ…‹ */
    .empty{background:#fff;border:2px dashed #D4AF37;border-radius:14px;padding:50px 20px;text-align:center;margin-bottom:16px}
    .empty img{width:120px;margin:0 auto 12px;display:block}
    .empty .tit{font-size:17px;color:#8B0000;margin-bottom:6px}
    .empty .sub{font-size:13px;color:#666;margin-bottom:18px}
    .empty button{padding:10px 32px;background:#8B0000;color:#FFD700;border:none;border-radius:20px;font-size:15px}
    /* æœå‹™å®®æ ¼ */
    .grid{background:#fff;border-radius:12px;display:grid;grid-template-columns:repeat(4,1fr);gap:12px;padding:14px;text-align:center;font-size:12px;margin-bottom:12px}
    .grid i{display:block;width:44px;height:44px;margin:0 auto 6px;background:#8B0000;color:#FFD700;border-radius:10px;line-height:44px;font-style:normal;font-size:20px}
    /* å­æœå‹™å½ˆçª— */
    .mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:999}
    .popup{background:#fff;width:90%;max-width:360px;border-radius:14px;padding:18px;text-align:center}
    .popup h4{font-size:16px;color:#8B0000;margin-bottom:10px}
    .popup .mini-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:10px 0;font-size:12px}
    .popup .mini-grid div{background:#faf6f0;border-radius:8px;padding:10px 4px}
    .popup button{width:100%;margin-top:10px;padding:10px;background:#8B0000;color:#FFD700;border:none;border-radius:6px}
    /* ç†±é–€æ¬Šç›Šæ©«æ»‘ */
    .benefit{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px}
    .benefit .tit{font-size:15px;font-weight:bold;color:#8B0000;margin-bottom:8px}
    .benefit .scroll-x{display:flex;gap:10px;overflow-x:auto}
    .benefit .item{min-width:110px;background:linear-gradient(135deg,#D4AF37,#FFF2CC);border-radius:8px;padding:10px;font-size:12px;color:#8B0000}
    /* Dock */
    .dock{height:52px;background:#8B0000;display:flex;border-top:2px solid #D4AF37;position:fixed;bottom:0;left:0;right:0}
    .dock div{flex:1;text-align:center;font-size:11px;color:#FFD700;padding-top:6px}
  </style>
</head>
<body>

<header class="top-bar">
  <span class="back" onclick="history.back()">â€¹</span>
  <div class="tit">éŠ€è¡Œå¡</div>
  <span class="add" onclick="addCard()">ï¼‹</span>
</header>

<div class="scroll" id="scroll">
  <!-- å¡ç‰‡åˆ—è¡¨ -->
  <div id="cardList"></div>

  <!-- æœå‹™å®®æ ¼ -->
  <div class="grid">
    <div onclick="addCard()"><i>â•</i>æ–°å¢å¡ç‰‡</div>
    <div onclick="bindCard()"><i>ğŸ”—</i>ç¶å®šä»–è¡Œå¡</div>
    <div onclick="creditSub()"><i>ğŸ’³</i>ä¿¡ç”¨å¡</div>
    <div onclick="debitSub()"><i>ğŸ’°</i>ç°½å¸³é‡‘è</div>
    <div onclick="lcpsQR()"><i>ğŸ“±</i>LCPS æ”¶æ¬¾</div>
    <div onclick="transList()"><i>ğŸ“Š</i>äº¤æ˜“æ˜ç´°</div>
    <div onclick="limitMgr()"><i>ğŸ”’</i>é™é¡ç®¡ç†</div>
    <div onclick="moreSub()"><i>ï¸™</i>æ›´å¤šæœå‹™</div>
  </div>

  <!-- ç†±é–€æ¬Šç›Š -->
  <div class="benefit">
    <div class="tit">ç†±é–€æ¬Šç›Š</div>
    <div class="scroll-x">
      <div class="item" onclick="alert('å·²é ˜å– 20 ç›§å°¼èŒ²')">æ–°æˆ¶ç¶å¡è´ˆ 20 ç›§å°¼èŒ²</div>
      <div class="item" onclick="alert('é€±ä¸‰åŠ æ²¹ 5% å›é¥‹å·²é–‹å•Ÿ')">é€±ä¸‰åŠ æ²¹ 5% å›é¥‹</div>
      <div class="item" onclick="alert('æ©Ÿå ´è²´è³“å®¤é ç´„æˆåŠŸ')">æ©Ÿå ´è²´è³“å®¤ 3 æ¬¡/å¹´</div>
      <div class="item" onclick="alert('é›»å½±ç¥¨ 50% æŠ˜æŠµåˆ¸å·²ç™¼æ”¾')">é›»å½±ç¥¨ 50% æŠ˜æŠµ</div>
      <div class="item" onclick="alert('ç©åˆ†å…Œå¤§æ¶¼é€šå¯¶å·²å…¥å¸³')">ç©åˆ†å…Œå¤§æ¶¼é€šå¯¶</div>
    </div>
  </div>
</div>

<!-- é€šç”¨å½ˆçª— -->
<div class="mask" id="mask">
  <div class="popup" id="popup"></div>
</div>

<nav class="dock">
  <div onclick="location.href='bank-home.html'">é¦–é </div>
  <div onclick="location.href='bank-card.html'" style="color:#fff">éŠ€è¡Œå¡</div>
  <div onclick="location.href='bank-transfer.html'">è½‰å¸³</div>
  <div onclick="location.href='bank-life.html'">ç”Ÿæ´»</div>
  <div onclick="location.href='#'">æˆ‘çš„</div>
</nav>

<script>
// IndexedDB å°è£…
const DB_NAME = 'daliang_cards', STORE = 'cards';
async function db() {
  return new Promise((res, rej) => {
    const r = indexedDB.open(DB_NAME, 1);
    r.onupgradeneeded = () => r.result.createObjectStore(STORE, { keyPath: 'id', autoIncrement: true });
    r.onsuccess = () => res(r.result);
    r.onerror = () => rej(r.error);
  });
}
async function getAll() {
  const tx = (await db()).transaction(STORE, 'readonly'), store = tx.objectStore(STORE);
  return await store.getAll();
}
async function addOne(card) {
  const tx = (await db()).transaction(STORE, 'readwrite');
  tx.objectStore(STORE).add(card);
  return tx.done;
}
async function delOne(id) {
  const tx = (await db()).transaction(STORE, 'readwrite');
  tx.objectStore(STORE).delete(id);
  return tx.done;
}

// æ¸²æŸ“é“¶è¡Œå¡
async function load() {
  const list = await getAll();
  const box = document.getElementById('cardList');
  if (list.length === 0) {
    box.innerHTML = `
      <div class="empty">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'%3E%3Crect width='120' height='120' rx='12' fill='%23D4AF37' opacity='.15'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-size='50' fill='%238B0000'%3EğŸ€«%3C/text%3E%3C/svg%3E"/>
        <div class="tit">æš«ç„¡éŠ€è¡Œå¡</div>
        <div class="sub">ç«‹å³æ–°å¢æˆ–ç¶å®šå¡ç‰‡ï¼Œé–‹å•Ÿå¤§æ¶¼å°Šæ¦®æœå‹™</div>
        <button onclick="addCard()">+ æ–°å¢å¡ç‰‡</button>
      </div>`;
  } else {
    let html = '';
    list.forEach(c => {
      html += `
        <div class="card-item">
          <div class="type">${c.type} â€§ ç›§å°¼èŒ²å¸³æˆ¶</div>
          <div class="num">${c.num.match(/.{1,4}/g).join(' ')}</div>
          <div class="balance">é¤˜é¡ ${c.balance} ç›§å°¼èŒ²</div>
          <div class="btn-row">
            <button onclick="lcpsQR('${c.num}')">LCPS æ”¶æ¬¾ç¢¼</button>
            <button onclick="transDetail('${c.id}')">äº¤æ˜“æ˜ç´°</button>
            <button onclick="lockCard('${c.id}')">ä¸€éµé–å¡</button>
            <button onclick="delCard('${c.id}')">åˆªé™¤å¡ç‰‡</button>
          </div>
        </div>`;
    });
    box.innerHTML = html;
  }
}

// å¼¹çª—å°è£…
function pop(title, html) {
  document.getElementById('popup').innerHTML = `<h4>${title}</h4>${html}<button onclick="closePop()">é—œé–‰</button>`;
  document.getElementById('mask').style.display = 'flex';
}
function closePop() {
  document.getElementById('mask').style.display = 'none';
}

// å„æŒ‰é”®å¯¹åº”å­æœåŠ¡
function addCard() {
  const num = prompt('è«‹è¼¸å…¥ 16 ä½å¡è™Ÿï¼ˆæ¨¡æ“¬ï¼‰'); 
  if (!num || num.length < 12) return;
  const type = ['å¤§æ¶¼ç™½é‡‘å¡', 'å¤§æ¶¼é‡‘å¡', 'å¤§æ¶¼ç„¡é™å¡'][Math.floor(Math.random() * 3)];
  addOne({ num, type, balance: (Math.random() * 8e4 + 2e4).toFixed(2) }).then(load);
}

function bindCard() {
  pop('ç¶å®šä»–è¡Œå¡', `
    <div class="mini-grid">
      <div onclick="alert('å¤§å¤éŠ€è¡Œç¶å®šæˆåŠŸ')">å¤§å¤éŠ€è¡Œ</div>
      <div onclick="alert('å¤§å‘¨éŠ€è¡Œç¶å®šæˆåŠŸ')">å¤§å‘¨éŠ€è¡Œ</div>
      <div onclick="alert('å¤§å•†éŠ€è¡Œç¶å®šæˆåŠŸ')">å¤§å•†éŠ€è¡Œ</div>
      <div onclick="alert('åœ°æ–¹è¾²å•†ç¶å®šæˆåŠŸ')">åœ°æ–¹è¾²å•†</div>
      <div onclick="alert('ä¿¡ç”¨å¡ç¶å®šæˆåŠŸ')">ä¿¡ç”¨å¡</div>
      <div onclick="alert('é‡‘èå¡ç¶å®šæˆåŠŸ')">é‡‘èå¡</div>
    </div>`);
}

function lcpsQR(card) {
  const qrcode = card.replace(/\d/g, '*').slice(-4);
  pop('LCPS å‹•æ…‹æ”¶æ¬¾ç¢¼', `<div style="text-align:center"><svg width="180" height="180" xmlns="http://www.w3.org/2000/svg"><rect width="180" height="180" fill="#fff"/><text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="20" fill="#8B0000">QR-${qrcode}</text></svg><p>æ¯ 60 ç§’æ›´æ–°<br>å¡å°¾è™Ÿï¼š${card.slice(-4)}</p></div>`);
}

function transList() {
  pop('äº¤æ˜“æ˜ç´°', `<div style="max-height:50vh;overflow:auto">
    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee"><span>07-15 12:34</span><span>å¤§æ¶¼ç™¾è²¨</span><span style="color:#8B0000">-128.50</span></div>
    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee"><span>07-14 09:18</span><span>å¤§æ¶¼åŠ æ²¹</span><span style="color:#8B0000">-320.00</span></div>
    <div style="display:flex;justify-content:space-between;padding:6px 0;"><span>07-13 20:50</span><span>è–ªè³‡å…¥å¸³</span><span style="color:green">+18,000.00</span></div>
  </div>`);
}

function transDetail(id) {
  transList();
}

function limitMgr() {
  pop('é™é¡ç®¡ç†', `
    <label style="font-size:13px">å–®ç­†é™é¡ï¼ˆç›§å°¼èŒ²ï¼‰</label>
    <input id="perLimit" type="number" value="50000">
    <label style="font-size:13px">æ¯æ—¥é™é¡ï¼ˆç›§å°¼èŒ²ï¼‰</label>
    <input id="dayLimit" type="number" value="200000">
    <button onclick="alert('é™é¡å·²æ›´æ–°')">ä¿å­˜è¨­ç½®</button>`);
}

function lockCard(id) {
  pop('ä¸€éµé–å¡', `<p>å¡ç‰‡å°‡ç«‹å³é–å®šï¼Œ30 åˆ†é˜å¾Œè‡ªå‹•è§£é–</p>
    <button onclick="alert('é–å¡æˆåŠŸ');closePop();">ç¢ºå®šé–å¡</button>`);
}

function moreSub() {
  pop('æ›´å¤šæœå‹™', `
    <div class="mini-grid">
      <div onclick="alert('ç·šä¸Šæ›å¡ç”³è«‹å·²æäº¤')">ç·šä¸Šæ›å¡</div>
      <div onclick="alert('æ›å¤±ç”³è«‹å·²å—ç†')">ç·Šæ€¥æ›å¤±</div>
      <div onclick="alert('éƒµå¯„åœ°å€å·²æ›´æ–°')">éƒµå¯„åœ°å€</div>
      <div onclick="alert('é™„å¡ç”³è«‹å·²æäº¤')">é™„å¡ç®¡ç†</div>
      <div onclick="alert('å¹´è²»æ¸›å…å·²ç”Ÿæ•ˆ')">å¹´è²»æ¸›å…</div>
      <div onclick="alert('ç™¼ç¥¨è¼‰å…·å·²ç¶å®š')">ç™¼ç¥¨è¼‰å…·</div>
    </div>`);
}

function delCard(id) {
  if (confirm('ç¢ºèªåˆªé™¤ï¼Ÿ')) delOne(id).then(load);
}

// åˆå§‹åŒ–
load();
</script>
</body>
</html>