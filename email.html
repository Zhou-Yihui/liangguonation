<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>星门国家邮件系统 | SCMS</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- PWA 核心配置（照搬通信系统逻辑，适配小米浏览器） -->
  <meta name="theme-color" content="#0b0c2a"> <!-- 匹配页面主题色 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#0b0c2a">
  <meta name="apple-mobile-web-app-title" content="星门国邮">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="./manifest.json"> <!-- 关联PWA配置文件 -->
  <!-- 苹果设备专用图标 -->
  <link rel="apple-touch-icon" sizes="192x192" href="./1762422726708.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./1762422730443.png">
  <!-- 普通设备（小米浏览器等）专用图标 -->
  <link rel="icon" sizes="192x192" href="./1762422726708.png" type="image/png">
  <link rel="icon" sizes="512x512" href="./1762422730443.png" type="image/png">

  <style>
    body{font-family:"Microsoft YaHei",sans-serif;background:#0b0c2a;color:#fff;text-align:center;margin:0;}
    header{padding:25px;background:rgba(255,255,255,.05);}
    section{width:90%;max-width:400px;margin:30px auto;background:rgba(255,255,255,.08);padding:20px;border-radius:10px;}
    input,button{width:80%;padding:10px;margin:8px 0;border:none;border-radius:5px;}
    button{background:#f0c000;color:#000;cursor:pointer;font-size:16px;}
    button:hover{background:#ffd700;}
    #auth-msg{color:#ff9;margin-top:10px;height:20px;}
  </style>
</head>

<body>
  <header>
    <h1>星门国家邮件系统</h1>
    <h3>StarGate Civilization Mail System</h3>
  </header>

  <section id="auth-section">
    <input id="username" placeholder="用户名 / Username" autocomplete="off"><br>
    <input id="password" type="password" placeholder="密码 / Password" autocomplete="off"><br>
    <button onclick="login()">登录 / Login</button>
    <button onclick="register()">注册 / Register</button>
    <p id="auth-msg"></p>
  </section>

  <!-- 新增 Service Worker 注册代码（关键：让PWA生效） -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          await navigator.serviceWorker.register('./sw.js');
          console.log('星门国邮 PWA 注册成功');
        } catch (err) {
          console.log('星门国邮 PWA 注册失败:', err);
        }
      });
    }
  </script>

  <script>
    /* --------- 工具 --------- */
    const getUsers = () => JSON.parse(localStorage.getItem('SCMS-users') || '{}');
    const setUsers = u => localStorage.setItem('SCMS-users', JSON.stringify(u));
    const msg = txt => document.getElementById('auth-msg').textContent = txt;

    /* --------- 注册 --------- */
    function register(){
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      if(!u || !p) return msg('用户名和密码不能为空');
      const users = getUsers();
      if(users[u]) return msg('用户已存在');
      // ✅ 存完整邮箱
      users[u] = {
        password: p,
        email: u + '@lyurchxieria.com',
        inbox: [],
        sent: [],
        drafts: [],
        trash: []
      };
      setUsers(users);
      msg('注册成功，请登录');
    }

    /* --------- 登录 --------- */
    function login(){
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      const users = getUsers();
      if(users[u] && users[u].password === p){
        localStorage.setItem('SCMS-currentUser', u);
        location.href = 'home.html';
      }else{
        msg('用户名或密码错误');
      }
    }
  </script>
</body>
</html>
